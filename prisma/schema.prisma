// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

//User with an id, name and email as strings
model User {
    id              String @id @default(uuid())
    userId          String? @unique 
    organizationId  String?
    name            String
    email           String? @unique
    phoneNumber     String? @unique
    projects        Project[]
    tasks           Task[]
    role            Role @default(employee)
}

model Project {
    id              String @id @default(uuid())
    name            String
    organizationId  String
    users           User[]
    tasks           Task[]
    rooms           Room[]
    expenses        Expense[] 
    transactions    Transaction[] 
    currency        String @default("ZAR")
    currencySymbol  String @default("R")
    progress        Int @default(0)
    status          StatusCode @default(todo)
    statuses        Status[]
    dueDate         DateTime @default(now())
    startDate       DateTime @default(now())
    // This field is to identify whether we stop recursion in the db custom update method
    // TODO: Remove it once Prisma introduces custom arguments to update methods
    progressUpdate  Boolean? 
}

model Task {
    id              String      @id @default(uuid())
    name            String
    description     String
    users           User[]
    project         Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId       String
    rooms           Room[]
    expense         Expense[]    
    status          StatusCode @default(todo)
    statuses        Status[]
    dueDate         DateTime @default(now())
    // This field is to identify whether we stop recursion in the db custom update method
    // TODO: Remove it once Prisma introduces custom arguments to update methods
    progressUpdate  Boolean? 
}   

model Room {
    id              String      @id @default(uuid())
    name            String
    type            RoomType
    tasks           Task[]
    project         Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId       String
    progress        Int @default(0)
    status          StatusCode @default(todo)
    statuses        Status[]
    dueDate         DateTime @default(now())
}

model Expense {
    id              String      @id @default(uuid())
    name            String
    type            ExpenseType
    estimateQty     Float
    estimatePrice   Float
    quantity        Float?
    price           Float?
    project         Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId       String
    transactions    Transaction[] 
    task            Task?        @relation(fields: [taskId], references: [id], onDelete: Cascade)
    taskId          String?
    estimateCost    Float @default(0)
    cost            Float @default(0)
    updatedTime     DateTime @default(now())
    updatedDate     String @default("")
}

model Transaction {
    id              String      @id @default(uuid())
    project         Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId       String
    expense         Expense     @relation(fields: [expenseId], references: [id], onDelete: Cascade)
    expenseId       String
    vendor          String?
    date            DateTime @default(now())
    notes           String?
    price           Float
    quantity        Float
    cost            Float?
    ref             String?
    // This field is to identify whether we stop recursion in the db custom update method
    // TODO: Remove it once Prisma introduces custom arguments to update methods
    progressUpdate  Boolean? 
}

model Status {
    id              String      @id @default(uuid())
    status          StatusCode  @default(todo)
    previousStatus  StatusCode  @default(todo)
    dateTime        DateTime    @default(now())
    date            String      @default("")
    projectStartDate String     @default("")
    project         Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId       String
    task            Task?       @relation(fields: [taskId], references: [id], onDelete: Cascade)
    taskId          String?
    room            Room?       @relation(fields: [roomId], references: [id], onDelete: Cascade)
    roomId          String?
}

enum RoomType {
    foyer
    lounge
    passage
    kitchen
    diningroom
    bedroom
    bathroom
    study
    basement
    laundy
    gym
    garage
    other
}

enum StatusCode {
    todo
    inprogress
    done
    approved
}

enum Role {
    owner
    admin
    guest
    employee
}

enum ExpenseType {
    material
    labour
    fee
    other
}